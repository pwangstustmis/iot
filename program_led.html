<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>物聯網基本應用與實作</title>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link href="css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>

    <!-- Side-Nav -->
    <div class="side-navbar active-nav d-flex justify-content-between flex-wrap flex-column" id="sidebar">
      <ul class="nav flex-column text-white w-100">
        <li class="nav-item" style="background-color: #fff;padding-left:10px;padding-top:10px;border-bottom: rgb(255, 115, 0) 2px solid;font-size: 16pt;">
          <p style="color:rgb(248, 138, 11);font-weight: 700;">物聯網基本應用與實作</p>
        </li>
        <li class="mx-2">
          <span class="menuitem"><a href="index.html" class="nav-link">物聯網簡介、單晶片介紹、設定與軟體安裝</a></span>
        </li>
        <li class="mx-2">
          <span class="menuitem"><a href="program_led.html" class="nav-link">ESP32開發版簡介、程式簡介、全彩LED</a></span>
        </li>
        <li class="mx-2">
          <span class="menuitem"><a href="ai2.html" class="nav-link">APP開發-App Inventro 2</a></span>
        </li>
        <li class="mx-2">
          <span class="menuitem"><a href="bt.html" class="nav-link">單晶片藍芽設定與實作</a></span>
        </li>
        <li class="mx-2">
            <span class="menuitem"><a href="wifi.html" class="nav-link">WiFi設定與實作</a></span>
          </li>
          <li class="mx-2">
            <span class="menuitem"><a href="introhtml.html" class="nav-link">網頁HTML簡介</a></span>
          </li>     
        <li class="mx-2">
          <span class="menuitem"><a href="dht11-fan.html" class="nav-link">單晶片溫度感測與風扇控制</a></span>
        </li>
      </ul>
    </div>


    <!-- Main Wrapper -->
    <div class="p-2 my-container active-cont">
      <!-- Breadcrumb -->
      <div class="bg-light px-5" aria-label="breadcrumb" style="height:40px;position:fixed;width:100%;top:0;">
        <a class="btn border-0" id="menu-btn" style="position:fixed"><i class="fas fa-bars"></i></a>
        <ol class="breadcrumb">
          <li class="breadcrumb-item">ESP32開發版簡介、程式簡介、全彩LED</li>
        </ol>
      </div>
      <!--End Top Nav -->

      <!-- main page -->
      <div style="margin-top:50px;">
        <div class="px-3">
          <h3 class="text-danger">麵包版簡介</h3>
          <p>
            麵包板上有很多小插孔，可將各種電子元件根據需要進行插入或拔出，免去焊接的程序。如下圖所示，在麵包板的上下兩側分別有兩排插孔，一般是作為電源引入的通路，上方第一行標有「+」的一列，每組5個插孔連通均為正極。上方第二行標有「-」的一列，每組5個插孔均為接地，麵包板下方第一行與第二行結構相同。
          </p>
            <p>
              中間連接孔分為上下兩部分，是我們的主要的工作區域，用來插接元件和跳線。在同一直排的的5個插孔（即a-b-c-d-e，f-g-h-i-j）是互相連通的；直列和直列（即1-30）之間以及凹槽上下部分（即e-f）是不連通的。
          </p>
          <p>
            <img src="imgs/class-2/breadboard.jpg" width="60%">
          </p>
        </div>

        <div class="px-3">
          <h3 class="text-danger">C語言簡介</h3>
          <p>
            課程開發工具Arduino IDE使用C語言進行物聯的開發，在進入控制晶片的使用與各項應用前，課程先對C語言進行簡述。
          </p>
          <ul>
            <li>
              語法與變數：程式語言如同一般語言，編寫時有其既定的規則，這種規則就稱為程式語法，C語言每一行程式命令最後必須以 <code style="color:#f00">;</code> 符號標示命令結束，條件、迴圈與函數的命令會置於 <code style="color:#f00">{ }</code> 符號之間。程式利用變數儲存讀入或計算資料值，C語言便數名稱區分大小寫，也就是變數a與變數A為不同變數。
            </li>
            <li>
              資料類型用於設定變數儲存資料型態，Arduino IDE語言常用資料類型包含 char(字元)、int(整數)、float(單精準度/有小數資料)、bool(布林值true/false)、string(字串)、void(無傳回值，僅用於函數)。
<pre><code>
  char a='A';
  int b=5;
  float c=3.14;
  bool d=true;
  string e="長榮中學";
</code></pre>                          
            </li>
            <li>
              運算子代表運算符號，計算運算子 +、-、*、/、%，代表加、減、乘、除與求餘數(5%3答案為2)。
<pre><code>
  int b;    //宣告整數變數b
  int a=0;  //a值為0
  a=a+5;    //a值為5
  a=a-3;    //a值為2
  a=a*2;    //a值為4
  a=a/4;    //a值為1
  b=a%5;    //b值為1
</code></pre>
            </li>
            <li>
              比較運算子 ==、!=、&gt;、&gt;=、&lt;、&lt;= ，用於條件比較分別為 等於、不等於、大於、大於等於、小於、小於等於。
<pre><code>
  int a=0;  //a值為0
  if (a==0) {
    a=1;
  } else {
    a=2;
  }
</code></pre>
            </li>
            <li>
             邏輯運算子 &&(且)、||(或)，用於串接多個條件比較。
<pre><code>
  int a=3;  //a值為3
  if ((a!=0) && (a%2==0)) {
    a=1;
  } else {
    a=2;
  }
</code></pre>
            </li>
          </ul>
        </div>
        <div class="px-3">
          <h3 class="text-danger">條件</h3>
          <p>
              if條件命令包含 <span class="text-danger">if、if else、if else if else</span>，分別為一個條件動作、兩個條件動作與多個條件動作。
          </p>
          <pre><code>
//if
if (1&lt;2) {
  Serial.print("1小於2");
}
//if else
if (1&lt;2) {
  Serial.print("1小於2");
} else {
  Serial.print("1不小於2");
}
//if else if else
if (1&gt;2) {
  Serial.print("1大於2");
} else if (1==2) {
  Serial.print("1等於2");
} else {
  Serial.print("1小於2");
}
          </code></pre>
          <p>
              swicth執行多條件命令。
          </p>
          <pre><code>
//swicth 每個值至於 case之後，default為所有條件不滿足，每個動作需加break
int x=1;
switch (x) {
  case 3:
    Serial.print("x為3");
    break;
  case 2:
    Serial.print("x為2");
    break;
  default:
    Serial.print("x不為2或3");
}
          </code></pre>
      </div>
      <div class="px-3">
          <h3 class="text-danger">迴圈</h3>
          <p>
              迴圈命令包含 <span class="text-danger">while、do while、for</span>，while、do while差別 <span class="text-danger">結束條件在一開始或結束條件在最後</span>，for迴圈使用方式 <span class="text-danger">for (int 變數=起始值;變數結束條件設定;變數增加值設定)</span>。
          </p>
          <pre><code>
//while印出1到10數字
int i=1;
while (i&lt;=10) {
  Serial.print("{0,2:d}",i);
  i=i+1;
}
//do while印出1到10數字
i=1;
do {
  Serial.print("{0,2:d}",i);
  i=i+1;
} while (i&lt;=10);
//for印出1到10數字
for (i=1;i&lt;=10;i++) {
  Serial.print("{0,2:d}",i);
}
          </code></pre>
      </div>

        <div class="px-3">
          <h3 class="text-danger">ESP32開發版(NodeMCU 32s)簡介</h3>
          <p>
            了解如何使用麵包版後，在進行物聯操作時，<span class="text-danger">要確定所有的零件極性(正極或負極)與負載(超載會燒壞零件)，電流由正極流向負極，接好所有線路，確認後再進行通電(接上USB)，這樣可以避免因操作不當，將開發版或零件燒毀，要進行線路的更動時，一定要將開發版斷電(拔除USB連接線)</span>。      
          </p>
          <p>
            進行物聯設計之前，必須了解開發版的功能及其對應腳位，下圖為課程使用ESP32開發版(NodeMCU 32s)腳位圖：         
          </p>
          <p>
            <img src="imgs/class-2/esp32pins.jpg" width="60%">
          </p>
          <ul>
            <li>輸出電源與接地：NodeMCU 32s包含 <span class="text-danger">5V(紅色)及3.3V(橘色)</span> 正極(高電位)，接地(負極或低電位)以 <span class="text-danger">GND(黑色)</span> 表示。電流由高電位流向低電位，ESP32 GPIO接腳輸出為直流電，電壓為3.3V。<span class="text-danger">請注意：不可以將GPIO接腳直接接地，因為中間沒有阻抗，會將開發版燒毀。</span>
            </li>
            <li>通用輸入輸出(GPIOx)：圖片中標是白色的腳位，可用於進行數位訊號輸入或輸出，GPIO之後數字代表通用輸入輸出腳位號碼。使用者可以利用GPIO進行數位控制，可使用GPIO(4,5,12-27,32-39)，但是GPIO34-GPIO39僅供訊號輸入使用。
            </li>
            <li>類比訊號輸入(ADC)：圖片中淺藍色的腳位，用於將讀入類比訊號轉為數位訊號。
            </li>
            <li>電容接觸感測(Touch)：用於偵測人類手指接觸生的電容差。
            </li>
            <li>序列傳輸(RX/TX)：進行序列資料接收與傳送。
            </li>
            <li>快取(FLASH)：用於系統快取，不建議使用這些腳位。
            </li>
          </ul>
          </p>
        </div>
        <div class="px-3">
          <h3 class="text-danger">Arduino IDE常用命令</h3>
          <p>
            Arduino IDE常用命令將依照不同目的進行介紹。
          </p>
          <ul>
            <li>
              <p>數位腳位輸出或輸入：在Arduino要進行數位腳位輸出或輸入，先必須使用命令 <span class="text-danger">pinMode(數位腳位號碼,INPUT或OUTPUT)</span> 進行數位腳位設定，設定為 <span class="text-danger">INPUT</span> 代表要從該數位腳位讀入數位訊號(HIGH或LOW)，其中 <span class="text-danger">HIGH</span> 代表有通電，<span class="text-danger">LOW</span> 代表關沒通電。設定為 <span class="text-danger">OUTPUT</span> 時，代表要從該數位腳位輸出數位訊號(HIGH或LOW)，其中 <span class="text-danger">HIGH</span> 代表有開通電，<span class="text-danger">LOW</span> 代表關沒通電。設定完畢後，可以透過 <span class="text-danger">digitalWrite(數位腳位號碼,HIGH或LOW)、digitalRead(數位腳位號碼)</span> 來輸出或讀入數位訊號。以下圖控制LED為例，LED正極(長腳)接在控制晶片數位腳位16，負極(短腳)接地在回到控制晶片接地腳位(GND)，要進行下圖控制，首先必須設定 <span class="text-danger">pinMode(16,OUTPUT)</span> ，代表透過控制數位腳位16輸出的 HIGH 或 LOW，可以控制電流是否通過LED。設定完畢後，透過 <span class="text-danger">digitalWrite(16,HIGH)</span>來開啟LED，透過 <span class="text-danger">digitalWrite(16,LOW)</span>來關閉LED。程式中 <span class="text-danger">delay(2000)</span> 代表等待2000毫秒(2秒)。</p>
              <p><img src="imgs/class-2/pin16led.jpg"></p>
              <p class="text-danger">程式碼：</p>
              <pre><code>
void setup() {
  pinMode(16,OUTPUT);
}
                
void loop() {
  digitalWrite(16,HIGH);
  delay(2000);
  digitalWrite(16,LOW);
  delay(2000);
}
              </code></pre>
            </li>
          </ul>
        </div>
        
        <div class="px-3">
          <h3 class="text-danger">第一個Arduino IDE程式</h3>
          <p>
            第一個Arduino IDE程式使用預設數位輸出腳位(GPIO2或LED_BUILTIN)控制開發版上預設LED以1秒間格進行閃爍。請開啟Arduino IDE後，選擇 <code style="color:#f00">檔案/範例/01.Basics/Blink</code> 。Arduino程式包含兩個無傳回值(void)函數 <code style="color:#f00">setup()與loop()</code>，setup()用於開發版啟動時的設定，只會執行一次，之後開發版將重複執行loop()函數中的命令，兩個函數的所有命令均需置於<code style="color:#f00">{ }</code> 符號之間。程式包含三個Arduino命令：<code style="color:#f00">pinMode、digitalWrite、delay</code>。pinMode命令用於設定GPIO腳位的模式，需要兩個代入值分別為 GPIO腳位 與 腳位模式(<code style="color:#f00">INPUT或OUTPUT</code>)，程式中 LED_BUILTIN 為系統預設代表GPIO2腳位，使用者可以用 2 取代 LED_BUILTIN，執行完 setup() 之後，程式將開發版GPIO2腳位設定為可輸出。<br/>執行完 set()函數之後，程式將重複執行 loop() 中命令，loop()中第一個命令為 <code style="color:#f00">digitalWrite(LED_BUILTIN,HIGH);</code> ，digitalWrite命令需要兩個代入值分別為設定輸出的 GPIO腳位 與 輸出值(<code style="color:#f00">HIGH或LOW</code>)，當輸出值為 <code style="color:#f00">HIGH</code> 時，會開通對應的接腳，電流會從接腳輸出。當輸出值為 <code style="color:#f00">LOW</code> 時，則關閉對應接腳的電流輸出。delay命令用於設定延遲，讓程式暫停一段時間，delay命令代入數字代表延遲時間，時間以毫秒(千分之一秒)表示，因此delay(1000)代表延遲1秒，因此Blink程式在開始 setup() 設定輸出腳位後，loop() 程式會開通開發版預設LED的GPIO接腳後，延遲1秒後，將其關閉並延遲1秒，之後繼續執行loop()函數。
          </p>
          <img src="imgs/class-2/prog-1.png"><p></p>
          
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：請練習改變開發版上LED閃爍時間，例如亮4秒，暗2秒。
          </h4><p></p>
        </div>

        <div class="px-3">
          <h3 class="text-danger">開關外接LED</h3>
          <p>
            知道如何開關開發版上LED之後，<span class="text-danger">請將開發版USB連接線拔除</span>，接下來我們將進行LED線路連接。LED有分正負極(如下圖)，長腳為正極，短腳為負極，電源由LED正極進入再由LED負極流出，LED有最大電流限制，超過電流會導致LED燒毀，所以接LED時需要再LED正端或負端串接一個電阻作為LED保護用。
          </p>
          <img src="imgs/class-2/ledpn.png"><p></p>
          <p>
            請選擇可用GPIO腳位並修改上一個閃爍程式來控制外部LED，LED接線如下 <span class="text-danger">LED正極 - LED負極 - 電阻 - GND(接地)</span>，例如腳位設定為 GPIO22，當設定 <span class="text-danger">digitalWrite(22,HIGH)</span> 時，電流會從GPIO22腳位經過 <span class="text-danger">LED正極 - LED負極 - 電阻 - GND(接地)</span>。確定線路無誤後，再將開發版接上USB。
          </p>
        </div>

        <div class="px-3">
          <h3 class="text-danger">脈衝寬度調變(PWM)外接LED</h3>
          <p>
            脈衝寬度調變(PWM)是一種利用數位訊號模擬類比訊號的方式。通常可以用於調整燈光的亮度、馬達的轉速、RGB LED 的配色、螢幕亮度控制、喇叭的大小聲/聲音頻率等。接下來實驗要利用脈衝寬度調變(PWM)讓LED有不同亮度變化，要使用PWM，開發版ESP32須執行下列兩個步驟。
          </p>
          <ul>
            <li>
              首先在setup()函數執行 <span class="text-danger">ledcSetup(通道,頻率,輸出週期)、ledcAttachPin(GPIO接腳,通道)</span> 命令，ledcSetup用於設定要使用的PWM通道，ESP32總共有16通道(0到15)，頻率一般設為5000，輸出週期值可以從1到16，代表輸出週期位元數，通常我們輸出週期會設為 8 (代表有256種變化，0到255)。<br/>設定完通道及頻率後，接下來利用 ledcAttachPin將GPIO接腳綁定至對應的通道。以上一個開關LED為例，在setup()中程式會改為下列程式，程式設定通道0、頻率5000、LED設定變化256種(0到255)，之後將數位接腳22綁至通道0。<p></p>
<pre><code>
  ledcSetup(0,5000,8);
  ledcAttachPin(22,0);
</code></pre>
            </li>
            <li>
              完成setup()中相關設定後，在loop()函數執行 <span class="text-danger">ledcWrite(通道,週期值)</span> 命令即可控制LED亮度，因為 ledcSetup 輸出週期值設8，週期值 0 代表 關閉，週期值 127 代表 一半亮度，週期值 255 代表 全亮。下列為完整程式包含：設定完通道0、頻率5000、輸出週期8，用 ledcAttachPin 將 GPIO22 接腳綁定至對應的通道並執行 LED暗2秒、一半亮度2秒、全亮2秒。<p></p>
<pre><code>
  void setup() {
    ledcSetup(0,5000,8);
    ledcAttachPin(22,0);
  }
  void loop() {
    ledcWrite(0,0);
    delay(2000);
    ledcWrite(0,125);
    delay(2000);
    ledcWrite(0,255);
    delay(2000);
 }
</code></pre>             
            </li>
          </ul>
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：利用程式迴圈讓LED漸變亮後，停2秒，再逐漸變暗，再停2秒。
          </h4><p></p>
        </div>

        <div class="px-3">
          <h3 class="text-danger">全彩(RGB)LED</h3>
          <p>
            全彩(RGB)LED接腳如下圖：
          </p>
          <img src="imgs/class-2/rgbled.png"><p></p>
          <p>
            全彩LED因為有三個輸入，因此必須串接3個電阻，請將全彩LED的 GND 接至開發版GND腳位，另外選擇三個GPIO腳位來串接紅(R)、綠(G)、藍(B)，開關或PWM設定同單顆LED。<code style="color:#f00">請注意：全彩LED會依紅(R)、綠(G)、藍(B)不同設定值而產生不同的顏色</code>。
          </p>
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：利用開關LED步驟，設定全彩LED紅色1秒、綠色1秒、藍色1秒。
          </h4><p></p>
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：利用LED PWM步驟，設定全彩LED呼吸燈。
          </h4><p></p>
        </div>
        <div class="px-3">
          <h3 class="text-danger">序列埠監控視窗</h3>
          <p>
            接上開發版後，使用者選擇 <code style="color:#f00">工具/序列埠監控視窗</code>可開啟如下圖監控視窗，使用者可在Arduino程式利用 <code style="color:#f00">Serial.print()或Serial.println()</code> 命令將答案輸出序列埠監控視窗，其目的是要透過監控視窗了解程式執行狀況。要使用序列埠，請在 setup()程式中設定 <code style="color:#f00">Serial.begin(序列埠傳輸速率);</code> ，一般傳輸速率設為 115200，同時執行程式後，序列埠監控視窗下方速率請設成相同的速率(如115200baud)，否則就無法溝通。
          </p>
          <img src="imgs/class-2/serialwindow.png"><p></p>
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：請在開關LED程式 setup()中一開始加入 <code style="color:#f00">Serial.begin(115200);</code> ，接下來輸入命令 <code style="color:#f00">Serial.print("設定序列埠速度");</code> ，開啟序列埠監控視窗並確定傳輸速率為 115200baud，之後進行程式燒錄並觀看序列埠監控視窗輸出結果。
          </h4><p></p>
        </div>
        <div class="px-3">
          <h3 class="text-danger">觸控開關LED</h3>
          <p>
            透過讀取電容接觸感測(Touch)腳位值來判定使否有接觸，實驗分為兩個部分，首先我們要知道當手接觸電容接觸感測(Touch)腳位時的數值是多少，接下來利用這個數值當作判斷基準來開關LED。要讀取電容接觸感測(Touch)腳位值使用 <code style="color:#f00">touchRead(腳位)</code> 命令即可讀出該腳位現在值。
          </p>
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：請同學使用電容接觸感測(Touch)腳位 4，並將讀取數值輸出到序列埠監控視窗，讀取間格0.1秒。
          </h4><p></p>
          <h4 style="color:rgb(234, 0, 255);font-size:14pt;font-weight:bold;">
            練習：請同學利用開關LED範例並使用電容接觸感測(Touch)腳位 4值來控制LED開關。
          </h4><p></p>
          <button onclick="document.getElementById('touchsol').style.visibility='visible';">答案</button>
          <div id="touchsol" style="visibility: hidden;color:#f00">
            bool power=false;<br/>
            void setup() {<br/>
              &nbsp;&nbsp;&nbsp;Serial.begin(115200);<br/>
              &nbsp;&nbsp;&nbsp;pinMode(22,OUTPUT);<br/>
              &nbsp;&nbsp;&nbsp;digitalWrite(22,LOW);<br/>
            }<br/>

            void loop() {<br/>
              &nbsp;&nbsp;&nbsp;int t=touchRead(4);<br/>
              &nbsp;&nbsp;&nbsp;Serial.println(t);<br/>
              &nbsp;&nbsp;&nbsp;if (t&lt;10) {<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digitalWrite(22,HIGH);<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (power)<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digitalWrite(22,LOW);<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digitalWrite(22,HIGH);<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;power=!power;<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.println(power);<br/>
                &nbsp;&nbsp;&nbsp;}<br/>
                &nbsp;&nbsp;&nbsp;delay(500);<br/>
            }<br/>
          </div>
        </div>
             
      </div>
    </div>

    <!-- bootstrap js -->
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>  
    
    <!-- custom js -->
    <script>
      var menu_btn = document.querySelector("#menu-btn");
      var sidebar = document.querySelector("#sidebar");
      var container = document.querySelector(".my-container");
      menu_btn.addEventListener("click", () => {
        sidebar.classList.toggle("active-nav");
        container.classList.toggle("active-cont");
      });
    </script>
  </body>
</html>
